<!doctype html>
<!--[if IE 9]>
<html class="lt-ie10" lang="en"> <![endif]-->
<html class="no-js" lang="en" data-useragent="Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Trident/6.0)">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title></title>

  <meta name="description"
        content="Bolt Protocol - a highly efficient, lightweight messaging protocol for databases"/>

  <link rel="canonical" href="https://boltprotocol.org/v1/transport.html" />

  <meta name="copyright" content="Creative Commons 3.0 Attribution-ShareAlike"/>

  <link rel="stylesheet" href="/css/foundation.css"/>
  <link rel="stylesheet" href="/css/asciidoctor.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/coderay.css"/>

  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/images/apple-touch-icon-57x57.png" />
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/images/apple-touch-icon-60x60.png" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/images/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/images/apple-touch-icon-76x76.png" />
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/images/apple-touch-icon-152x152.png" />
  <link rel="icon" type="image/png" href="/images/favicon-196x196.png" sizes="196x196" />
  <link rel="icon" type="image/png" href="/images/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16" />
  <link rel="icon" type="image/png" href="/images/favicon-128.png" sizes="128x128" />
  <meta name="application-name" content="&nbsp;"/>
  <meta name="msapplication-TileColor" content="#FFFFFF" />
  <meta name="msapplication-TileImage" content="/images/mstile-144x144.png" />
  <meta name="msapplication-square70x70logo" content="/images/mstile-70x70.png" />
  <meta name="msapplication-square150x150logo" content="/images/mstile-150x150.png" />
  <meta name="msapplication-wide310x150logo" content="/images/mstile-310x150.png" />
  <meta name="msapplication-square310x310logo" content="/images/mstile-310x310.png" />

  <script src="/js/vendor/modernizr.js"></script>
  <script src="/js/toc.js"></script>
</head>
<body>

<nav class="top-bar" data-topbar>
  <ul class="title-area">
    <!-- Title Area -->
    <li class="name">
      <h1><a href="/">Bolt Protocol</a></h1>
    </li>
    <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
  </ul>

  <section class="top-bar-section">
    <ul class="left">
      <li class="has-dropdown name">
        <h1>
          <a href="/v1/">Version 1</a>
        </h1>
        <ul class="dropdown">
          <li><a href="/v1/#overview">Overview</a></li>
          <li><a href="/v1/#transport">Transport Layer</a></li>
          <li><a href="/v1/#messaging">Messaging</a></li>
          <li><a href="/v1/#serialization">Serialization</a></li>
          <li><a href="/v1/#examples">Examples</a></li>
        </ul>
      </li>
    </ul>
    <ul class="right hide-for-small">
      <img src="/images/boltprotocol.png" style="height: 6rem;margin: 5px 5px 0 0;" />
    </ul>
  </section>
</nav>

<section role="main" class="scroll-container">
  <div class="row">
    <div class="small-12 columns" role="content">
      <h1></h1>
      <div class="sect1">
<h2 id="transport"><a class="anchor" href="#transport"></a>Bolt Transport Layer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The protocol supports both regular <a href="http://en.wikipedia.org/wiki/Network_socket">socket</a> and <a href="http://en.wikipedia.org/wiki/WebSocket">WebSocket</a> transport layers for sending and receiving messages.
The transport layer is versioned along with the rest of the Bolt Protocol and is responsible for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Negotiating Bolt Protocol version</p>
</li>
<li>
<p>Establishing and terminating sessions</p>
</li>
<li>
<p>Routing messages from clients to specific sessions and back</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="sessions"><a class="anchor" href="#sessions"></a>Sessions</h3>
<div class="paragraph">
<p>Each connection to the server creates a new <strong>session</strong> that lives until that connection is closed.
Each session is isolated and the server keep track of the current state, based on the requests and responses exchanged within that session.</p>
</div>
</div>
<div class="sect2">
<h3 id="connecting"><a class="anchor" href="#connecting"></a>Connecting</h3>
<div class="paragraph">
<p>To begin a new session, the client connects using either a regular socket or a WebSocket.
Once connected, both transport layers can be treated identically.</p>
</div>
<div class="paragraph">
<p>If the server has been configured to enable encryption, TLS, the connections need to be made using a secure socket or a secure WebSocket.</p>
</div>
<div class="paragraph">
<p>A regular socket connection should be made to the host and port the server has been configured to use for its regular socket listener.
The default port for regular socket connections is <strong>7687</strong>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If TLS is enabled, and no certificate has been specified, the server should automatically generate a self-signed
 TLS certificate. It is vital that your database driver not simply accept any certificate without validating it. If
 you do not verify the certificate it is very simple to bypass the encryption. You should either ensure you have a
 valid signed certificate installed with the server or that your application implements trust on first use.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="handshake"><a class="anchor" href="#handshake"></a>Handshake</h3>
<div class="paragraph">
<p>After connecting, a handshake takes place to establish which Bolt protocol version should be used for that connection.
This handshake is a <em>version-independent</em> mini-protocol which is guaranteed to remain the same, regardless of preferred or available protocol versions.</p>
</div>
<div class="paragraph">
<p>In the handshake, the client fist sends a magic four byte preamble (6060 B017) followed by four protocol versions it supports, in order of preference.
The proposal is always represented as four 32-bit unsigned integers.
Each integer represents a proposed protocol version to use, or zero (<code>00 00 00 00</code>) for "none".</p>
</div>
<div class="paragraph">
<p>The server will respond with a single 32-bit unsigned integer representing the chosen protocol.
This will always represent the highest-priority protocol version the server supports.
If none of the proposed protocols are supported, the server responds with zero (<code>00 00 00 00</code>) and closes the connection.</p>
</div>
<div class="listingblock">
<div class="title">Initial handshake</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bolt_exchange">Client: &lt;connect&gt;
Client: 60 60 B0 17
Client: 00 00 00 01  00 00 00 00  00 00 00 00  00 00 00 00
      #  Version 1      None         None         None

Server: 00 00 00 01
      #   Choose
      #  version 1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">No supported version</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bolt_exchange">Client: &lt;connect&gt;
Client: 60 60 B0 17
Client: 00 00 00 06  00 00 00 00  00 00 00 00  00 00 00 00
      #   Version 6      None         None         None

Server: 00 00 00 00
      #    None
      #  supported

Server: &lt;disconnect&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="message_transfer_encoding"><a class="anchor" href="#message_transfer_encoding"></a>Message transfer encoding</h3>
<div class="paragraph">
<p>Bolt encodings each message using a chunked transfer encoding.
Each message is transferred as one or more <code>chunks</code> of data.
Each chunk starts with a two-byte header, an unsigned big-endian 16-bit integer, representing the size of the chunk not including the header.
A message can be divided across multiple chunks, allowing client and server alike to transfer large messages without having to determine the length of the entire message in advance.</p>
</div>
<div class="paragraph">
<p>Each message ends with two bytes with the value <code>00 00</code>, these are not counted towards the chunk length.</p>
</div>
<div class="listingblock">
<div class="title">A message in one chunk</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bolt_chunking_example">Chunk size: 16
Message data: 00 01 02 03  04 05 06 07  08 09 0A 0B  0C 0D 0E 0F

00 10  00 01 02 03  04 05 06 07  08 09 0A 0B  0C 0D 0E 0F  00 00
chunk  |                    Message                     |   End
header |                     Data                       |  Marker</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">A message split in two chunks</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bolt_chunking_example">Chunk size: 16
Message data: 00 01 02 03  04 05 06 07  08 09 0A 0B  0C 0D 0E 0F  01 02 03 04

00 10  00 01 02 03  04 05 06 07  08 09 0A 0B  0C 0D 0E 0F  00 04  01 02 03 04  00 00
chunk1 |                    Message                     |  chunk2 | Message |   End
header |                     Data                       |  header |  Data   |  Marker</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Two messages</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bolt_chunking_example">Chunk size: 16
Message 1 data: 00 01 02 03  04 05 06 07  08 09 0A 0B  0C  0D 0E 0F
Message 2 data: 0F 0E 0D 0C  0B 0A 09 08

00 10  00 01 02 03  04 05 06 07  08 09 0A 0B  0C 0D 0E 0F  00 00
chunk  |                   Message 1                    |   End
header |                     Data                       |  Marker

00 08  0F 0E 0D 0C  0B 0A 09 08  00 00
chunk  |       Message 2      |   End
header |         Data         |  Marker</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="disconnecting"><a class="anchor" href="#disconnecting"></a>Disconnecting</h3>
<div class="paragraph">
<p>A session ends when its communication socket is closed.
Typically, this will be closed by the client.</p>
</div>
</div>
</div>
</div>
    </div>
  </div>
</section>

<footer class="row">
  <div class="large-12 columns">
    <hr/>
    <div class="row">
      <div class="large-12 columns">
        <p>Licensed under <a href="https://creativecommons.org/licenses/by-sa/3.0/">Creative Commons 3.0 Attribution-ShareAlike</a>.</p>
        <p><a href="https://github.com/neo4j/neo4j/tree/3.0.6/manual/bolt/src/docs/dev">Originally authored</a> by <a href="https://neo4j.com">Neo Technology, Inc.</a>, with modifications to original source for publishing and clarity.</p>
      </div>
    </div>
  </div>
</footer>

<script src="/js/vendor/jquery.js"></script>
<script src="/js/foundation.min.js"></script>
<script>
  $(document).foundation();
</script>
<script src="/js/vendor/jquery.js"></script>
<script src="/js/foundation/foundation.js"></script>
<script>
  $(document).foundation();
  var doc = document.documentElement;
  doc.setAttribute('data-useragent', navigator.userAgent);
</script>
</body>
</html>
